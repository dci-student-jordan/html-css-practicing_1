<!DOCTYPE html>
<head>
  <link rel="stylesheet" href="../style.css">
</head>
<html>
<header>
  <h1>requested promises</h1>
</header>
<body>
  <h1>My first requested Data</h1>
<section class="content">
  <p id="iss">Fetch some free data awailable with this button.</p>
  <input id="fetchButton" type="button" value="Get data" onclick="getResponse();" />
</section>
<script>
  var fetching = false
  const fetchText = document.querySelector("#iss")
  async function getResponse() {
    fetching = true
    fetchText.textContent = "fetching data.."
    fetchingData()
    const host = 'api.open-notify.org';
    const fetchButton = document.querySelector("#fetchButton")
    try {
      await fetch(`http://${host}/iss-now.json`)
      .then(resp => resp.json())
      .then((data) => {
        fetchText.textContent = `the ISS is Located here :Latitude :${data.iss_position.latitude}; Longitude: ${data.iss_position.longitude}`;
      })
      await fetch(`http://${host}/astros.json`)
      .then(resp => resp.json())
      .then((data) => {
        var numText = document.createTextNode(`Currently  ${data.number} people are in space right now: `)
        fetchButton.parentNode.appendChild(numText, fetchButton)
        for (i=0; i<data.people.length; i++) {
          var guy = data.people[i]
          var guyText = document.createTextNode(guy.name+ " is on the "+guy.craft + ((i==(data.people.length-2)) ? " and " : (i==(data.people.length-1)) ? " too." : ", "))
          fetchButton.parentNode.appendChild(guyText, fetchButton);
        }
      })
      var moreText = document.createElement('p')
    // moreText.textContent = "TestContent"
    // document.querySelector('section').appendChild(moreText)
      fetching = false
      fetchButton.setAttribute('hidden', 'true')
    } catch (error) {
        console.error(`Something went wrong! ${error.message}`)
        fetching = false
      }
  }
  function fetchingData () {
    fetchText.textContent = fetchText.textContent + "."
    if (fetching) setTimeout(()=> {fetchingData()},500)
  }
</script>
</body>

</html>